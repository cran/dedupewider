<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Usage and Algorithm Explained</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>$(document).ready(function(){
    if (typeof $('[data-toggle="tooltip"]').tooltip === 'function') {
        $('[data-toggle="tooltip"]').tooltip();
    }
    if ($('[data-toggle="popover"]').popover === 'function') {
        $('[data-toggle="popover"]').popover();
    }
});
</script>
<style type="text/css">
.lightable-minimal {
border-collapse: separate;
border-spacing: 16px 1px;
width: 100%;
margin-bottom: 10px;
}
.lightable-minimal td {
margin-left: 5px;
margin-right: 5px;
}
.lightable-minimal th {
margin-left: 5px;
margin-right: 5px;
}
.lightable-minimal thead tr:last-child th {
border-bottom: 2px solid #00000050;
empty-cells: hide;
}
.lightable-minimal tbody tr:first-child td {
padding-top: 0.5em;
}
.lightable-minimal.lightable-hover tbody tr:hover {
background-color: #f5f5f5;
}
.lightable-minimal.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-classic {
border-top: 0.16em solid #111111;
border-bottom: 0.16em solid #111111;
width: 100%;
margin-bottom: 10px;
margin: 10px 5px;
}
.lightable-classic tfoot tr td {
border: 0;
}
.lightable-classic tfoot tr:first-child td {
border-top: 0.14em solid #111111;
}
.lightable-classic caption {
color: #222222;
}
.lightable-classic td {
padding-left: 5px;
padding-right: 5px;
color: #222222;
}
.lightable-classic th {
padding-left: 5px;
padding-right: 5px;
font-weight: normal;
color: #222222;
}
.lightable-classic thead tr:last-child th {
border-bottom: 0.10em solid #111111;
}
.lightable-classic.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-classic.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-classic-2 {
border-top: 3px double #111111;
border-bottom: 3px double #111111;
width: 100%;
margin-bottom: 10px;
}
.lightable-classic-2 tfoot tr td {
border: 0;
}
.lightable-classic-2 tfoot tr:first-child td {
border-top: 3px double #111111;
}
.lightable-classic-2 caption {
color: #222222;
}
.lightable-classic-2 td {
padding-left: 5px;
padding-right: 5px;
color: #222222;
}
.lightable-classic-2 th {
padding-left: 5px;
padding-right: 5px;
font-weight: normal;
color: #222222;
}
.lightable-classic-2 tbody tr:last-child td {
border-bottom: 3px double #111111;
}
.lightable-classic-2 thead tr:last-child th {
border-bottom: 1px solid #111111;
}
.lightable-classic-2.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-classic-2.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-material {
min-width: 100%;
white-space: nowrap;
table-layout: fixed;
font-family: Roboto, sans-serif;
border: 1px solid #EEE;
border-collapse: collapse;
margin-bottom: 10px;
}
.lightable-material tfoot tr td {
border: 0;
}
.lightable-material tfoot tr:first-child td {
border-top: 1px solid #EEE;
}
.lightable-material th {
height: 56px;
padding-left: 16px;
padding-right: 16px;
}
.lightable-material td {
height: 52px;
padding-left: 16px;
padding-right: 16px;
border-top: 1px solid #eeeeee;
}
.lightable-material.lightable-hover tbody tr:hover {
background-color: #f5f5f5;
}
.lightable-material.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-material.lightable-striped tbody td {
border: 0;
}
.lightable-material.lightable-striped thead tr:last-child th {
border-bottom: 1px solid #ddd;
}
.lightable-material-dark {
min-width: 100%;
white-space: nowrap;
table-layout: fixed;
font-family: Roboto, sans-serif;
border: 1px solid #FFFFFF12;
border-collapse: collapse;
margin-bottom: 10px;
background-color: #363640;
}
.lightable-material-dark tfoot tr td {
border: 0;
}
.lightable-material-dark tfoot tr:first-child td {
border-top: 1px solid #FFFFFF12;
}
.lightable-material-dark th {
height: 56px;
padding-left: 16px;
padding-right: 16px;
color: #FFFFFF60;
}
.lightable-material-dark td {
height: 52px;
padding-left: 16px;
padding-right: 16px;
color: #FFFFFF;
border-top: 1px solid #FFFFFF12;
}
.lightable-material-dark.lightable-hover tbody tr:hover {
background-color: #FFFFFF12;
}
.lightable-material-dark.lightable-striped tbody tr:nth-child(even) {
background-color: #FFFFFF12;
}
.lightable-material-dark.lightable-striped tbody td {
border: 0;
}
.lightable-material-dark.lightable-striped thead tr:last-child th {
border-bottom: 1px solid #FFFFFF12;
}
.lightable-paper {
width: 100%;
margin-bottom: 10px;
color: #444;
}
.lightable-paper tfoot tr td {
border: 0;
}
.lightable-paper tfoot tr:first-child td {
border-top: 1px solid #00000020;
}
.lightable-paper thead tr:last-child th {
color: #666;
vertical-align: bottom;
border-bottom: 1px solid #00000020;
line-height: 1.15em;
padding: 10px 5px;
}
.lightable-paper td {
vertical-align: middle;
border-bottom: 1px solid #00000010;
line-height: 1.15em;
padding: 7px 5px;
}
.lightable-paper.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-paper.lightable-striped tbody tr:nth-child(even) {
background-color: #00000008;
}
.lightable-paper.lightable-striped tbody td {
border: 0;
}
</style>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Usage and Algorithm Explained</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>We can distinguish several types of deduplication when thinking about
table - across one column we could use <code>duplicated()</code> (or
<code>unique()</code>) to check (or remove) which records are
duplicated; across one row we could iterate over rows and use the same
<code>duplicated()</code> (or <code>unique()</code>) or gather multiple
columns into one (by changing table from wide format to long) and then
perform deduplication across one, long column.</p>
<p>Finally, we can think of deduplication as a process of finding
duplicated data across different columns <em>and</em> rows, using
transitive relation:</p>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
Tel_1
</th>
<th style="text-align:right;">
Tel_2
</th>
<th style="text-align:left;">
Name
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
111
</td>
<td style="text-align:right;">
222
</td>
<td style="text-align:left;">
name1
</td>
</tr>
<tr>
<td style="text-align:right;">
222
</td>
<td style="text-align:right;">
666
</td>
<td style="text-align:left;">
name2
</td>
</tr>
<tr>
<td style="text-align:right;">
444
</td>
<td style="text-align:right;">
666
</td>
<td style="text-align:left;">
name3
</td>
</tr>
<tr>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:left;">
name4
</td>
</tr>
</tbody>
</table>
<p>In the example above, we could treat records in rows 1, 2 and 3 as
the same record. Why? Because row 1 and 2 has one the same phone number
(222), row 2 and 3 has one the same phone number (666) and, because row
1 is duplicated with row 2, row 2 is duplicated with row 3, then row 1
is duplicated with row 3. User can see the result of this specific
deduplication by calling (after installation of package):</p>
<pre><code>example(&quot;dedupe_wide&quot;, &quot;dedupewider&quot;) # look at the first example</code></pre>
<p>This method was used in CATI surveys (especially on businesses
databases) to minimize the chance that interviewers will call
independently the same respondent and thus irritate her or him. It is a
chance that the same, suitable person to participate in the survey,
works in more than one company and that these companies exist as a
separate records in the database (sometimes just as a separate
companies, sometimes as a branches). When trying to find participant in
company X, interviewer can be switched to company C to speak with
employee E and the second interviewer, when calling company Y, can also
be switched to company C to speak with employee E. If some data in
database (like phone numbers) can be use to collapse companies X, Y and
C into one record, the chance for this inconvenience will be much
lower.</p>
</div>
<div id="usage" class="section level2">
<h2>Usage</h2>
<p>To attach the package, use: <code>library(dedupewider)</code>. We
will show the usage of <code>dedupe_wide()</code> function using the
table presented below:</p>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
tel_1
</th>
<th style="text-align:right;">
tel_2
</th>
<th style="text-align:right;">
tel_3
</th>
<th style="text-align:right;">
tel_4
</th>
<th style="text-align:right;">
tel_5
</th>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
nace
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
111
</td>
<td style="text-align:right;">
222
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name1
</td>
<td style="text-align:left;">
01.19
</td>
</tr>
<tr>
<td style="text-align:right;">
222
</td>
<td style="text-align:right;">
666
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name2
</td>
<td style="text-align:left;">
01.64
</td>
</tr>
<tr>
<td style="text-align:right;">
444
</td>
<td style="text-align:right;">
666
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name3
</td>
<td style="text-align:left;">
55.90
</td>
</tr>
<tr>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:left;">
name4
</td>
<td style="text-align:left;">
09.10
</td>
</tr>
</tbody>
</table>
<p>We already know that rows 1, 2, 3 will be collapsed into one. Let’s
see the default behavior of function:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(dedupewider)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>initial_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tel_1 =</span> <span class="fu">c</span>(<span class="dv">111</span>, <span class="dv">222</span>, <span class="dv">444</span>, <span class="dv">555</span>),</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>                            <span class="at">tel_2 =</span> <span class="fu">c</span>(<span class="dv">222</span>, <span class="dv">666</span>, <span class="dv">666</span>, <span class="dv">555</span>),</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>                            <span class="at">tel_3 =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">555</span>),</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>                            <span class="at">tel_4 =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">555</span>),</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>                            <span class="at">tel_5 =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">555</span>),</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>                            <span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;name&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>                            <span class="at">nace =</span> <span class="fu">c</span>(<span class="st">&quot;01.19&quot;</span>, <span class="st">&quot;01.64&quot;</span>, <span class="st">&quot;55.90&quot;</span>, <span class="st">&quot;09.10&quot;</span>))</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>table_deduplicated <span class="ot">&lt;-</span> <span class="fu">dedupe_wide</span>(initial_table, <span class="at">cols_dedupe =</span> <span class="fu">paste0</span>(<span class="st">&quot;tel_&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>                                  <span class="at">cols_expand =</span> <span class="st">&quot;name&quot;</span>)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>table_deduplicated</span></code></pre></div>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
tel_1….1
</th>
<th style="text-align:right;">
tel_1….2
</th>
<th style="text-align:right;">
tel_1….3
</th>
<th style="text-align:right;">
tel_1….4
</th>
<th style="text-align:left;">
name….1
</th>
<th style="text-align:left;">
name….2
</th>
<th style="text-align:left;">
name….3
</th>
<th style="text-align:left;">
nace
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
111
</td>
<td style="text-align:right;">
222
</td>
<td style="text-align:right;">
444
</td>
<td style="text-align:right;">
666
</td>
<td style="text-align:left;">
name1
</td>
<td style="text-align:left;">
name2
</td>
<td style="text-align:left;">
name3
</td>
<td style="text-align:left;">
01.19
</td>
</tr>
<tr>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name4
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
09.10
</td>
</tr>
</tbody>
</table>
<p>We can see that:</p>
<ul>
<li>columns used to dedupe are not just renamed, but also the number of
columns is lower than initially. That’s because argument
<code>enable_drop</code> was set (be default) to <code>TRUE</code> -
fifth column would contain only missing data (NA), so was removed</li>
<li>deduplication was performed also on the same row, so for company
“name4” only one phone number was left</li>
<li>all unique information from column “name” was preserved and these
columns were renamed</li>
<li>for the rest columns (“nace”) just one code was preserved - it is
always the data from the row which is closest to the beginning of the
table</li>
<li>order of rows and columns was preserved, <strong>however, it is
important to note that for <code>cols_dedupe</code> first element of
names passed to it will be used as a base for new names of columns and
to determine the place for these columns</strong></li>
<li><code>NA</code> values were moved to right. If you want different
result, like moving them to the left or even top or bottom, check out
the <code>na_move</code> function.</li>
</ul>
<p>Of course, columns passed to <code>cols_expand</code> are treat as
separate columns, so data is not mixed:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>table_deduplicated <span class="ot">&lt;-</span> <span class="fu">dedupe_wide</span>(initial_table, <span class="at">cols_dedupe =</span> <span class="fu">paste0</span>(<span class="st">&quot;tel_&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>                                  <span class="at">cols_expand =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;nace&quot;</span>))</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>table_deduplicated</span></code></pre></div>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
tel_1….1
</th>
<th style="text-align:right;">
tel_1….2
</th>
<th style="text-align:right;">
tel_1….3
</th>
<th style="text-align:right;">
tel_1….4
</th>
<th style="text-align:left;">
name….1
</th>
<th style="text-align:left;">
name….2
</th>
<th style="text-align:left;">
name….3
</th>
<th style="text-align:left;">
nace….1
</th>
<th style="text-align:left;">
nace….2
</th>
<th style="text-align:left;">
nace….3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
111
</td>
<td style="text-align:right;">
222
</td>
<td style="text-align:right;">
444
</td>
<td style="text-align:right;">
666
</td>
<td style="text-align:left;">
name1
</td>
<td style="text-align:left;">
name2
</td>
<td style="text-align:left;">
name3
</td>
<td style="text-align:left;">
01.19
</td>
<td style="text-align:left;">
01.64
</td>
<td style="text-align:left;">
55.90
</td>
</tr>
<tr>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name4
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
09.10
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p>Sometimes user can think that there is a fixed number of new columns
which will be enough (for example no more than 2 phone numbers to
company will be needed). Argument <code>max_new_cols</code> can be use
to set the number of max. new columns to create and it will be used to
limit number of columns from <code>cols_dedupe</code> <em>and</em>
<code>cols_expand</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>table_deduplicated <span class="ot">&lt;-</span> <span class="fu">dedupe_wide</span>(initial_table, <span class="at">cols_dedupe =</span> <span class="fu">paste0</span>(<span class="st">&quot;tel_&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>                                  <span class="at">cols_expand =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;nace&quot;</span>),</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>                                  <span class="at">max_new_cols =</span> <span class="dv">2</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>table_deduplicated</span></code></pre></div>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
tel_1….1
</th>
<th style="text-align:right;">
tel_1….2
</th>
<th style="text-align:left;">
name….1
</th>
<th style="text-align:left;">
name….2
</th>
<th style="text-align:left;">
nace….1
</th>
<th style="text-align:left;">
nace….2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
111
</td>
<td style="text-align:right;">
222
</td>
<td style="text-align:left;">
name1
</td>
<td style="text-align:left;">
name2
</td>
<td style="text-align:left;">
01.19
</td>
<td style="text-align:left;">
01.64
</td>
</tr>
<tr>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name4
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
09.10
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p>Functions <code>duplicated()</code> or <code>unique()</code> can
treat missing data as duplicated data, e.g.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">duplicated</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)) <span class="co"># returns FALSE TRUE</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)) <span class="co"># returns NA (vector of length 1)</span></span></code></pre></div>
<p>But <code>dedupe_wide</code> cannot treat missing data as duplicated
data, e.g. in case of this table:</p>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
tel_1
</th>
<th style="text-align:right;">
tel_2
</th>
<th style="text-align:left;">
name
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
111
</td>
<td style="text-align:right;">
222
</td>
<td style="text-align:left;">
name5
</td>
</tr>
<tr>
<td style="text-align:right;">
222
</td>
<td style="text-align:right;">
111
</td>
<td style="text-align:left;">
name6
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name7
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name8
</td>
</tr>
</tbody>
</table>
<p>Rows 1 and 2 will be collapsed to one, but the rest of rows remain
unchanged:</p>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
tel_1….1
</th>
<th style="text-align:right;">
tel_1….2
</th>
<th style="text-align:left;">
name….1
</th>
<th style="text-align:left;">
name….2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
111
</td>
<td style="text-align:right;">
222
</td>
<td style="text-align:left;">
name5
</td>
<td style="text-align:left;">
name6
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name7
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name8
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p>It is also important to note that this function was implemented using
<code>data.table</code> and thus parallel computing is possible. To
enable this, user can just call <code>data.table::setDTthreads()</code>
before using <code>dedupe_wide()</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDTthreads</span>()</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">dedupe_wide</span>(initial_table, <span class="at">cols_dedupe =</span> <span class="fu">paste0</span>(<span class="st">&quot;tel_&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                                  <span class="at">cols_expand =</span> <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
</div>
<div id="algorithm" class="section level2">
<h2>Algorithm</h2>
<p>The aim of this section is to show algorithm used to find duplicated
records - this can be use for cross-checking or can be a inspiration to
implement more efficient solution if needed. Table below will be our
starting point:</p>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
tel_1
</th>
<th style="text-align:right;">
tel_2
</th>
<th style="text-align:right;">
tel_3
</th>
<th style="text-align:right;">
tel_4
</th>
<th style="text-align:left;">
name
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
111
</td>
<td style="text-align:right;">
777
</td>
<td style="text-align:right;">
999
</td>
<td style="text-align:right;">
102
</td>
<td style="text-align:left;">
name1
</td>
</tr>
<tr>
<td style="text-align:right;">
222
</td>
<td style="text-align:right;">
666
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name2
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name3
</td>
</tr>
<tr>
<td style="text-align:right;">
444
</td>
<td style="text-align:right;">
666
</td>
<td style="text-align:right;">
333
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name4
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name5
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name6
</td>
</tr>
<tr>
<td style="text-align:right;">
666
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name7
</td>
</tr>
<tr>
<td style="text-align:right;">
777
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name8
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name9
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:right;">
777
</td>
<td style="text-align:right;">
101
</td>
<td style="text-align:right;">
103
</td>
<td style="text-align:left;">
name10
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:right;">
888
</td>
<td style="text-align:right;">
102
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
name11
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:right;">
777
</td>
<td style="text-align:right;">
777
</td>
<td style="text-align:right;">
103
</td>
<td style="text-align:left;">
name12
</td>
</tr>
</tbody>
</table>
<p>We can split the algorithm into two main steps - finding duplicates
and cascade them.</p>
<div id="find-duplicates" class="section level4">
<h4>Find duplicates</h4>
<p>At first, we need to gather all columns which will be used for
deduplication into one column, but keeping indexes to know which records
belong to the same row (below only first 6 rows are shown):</p>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
….idx
</th>
<th style="text-align:right;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
111
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
222
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
333
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
444
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
333
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
333
</td>
</tr>
</tbody>
</table>
<p>Now we can group by <em>value</em> and summarize indexes (column
V1):</p>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
V1
</th>
<th style="text-align:right;">
main_index
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
3, 5, 6, 9, 10, 11, 12, 4
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
7, 2, 4
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
8, 1, 10, 12
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
11, 1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
10, 12
</td>
<td style="text-align:right;">
10
</td>
</tr>
</tbody>
</table>
<p>We want also to have a main index which will be used as a replace. It
will be the lowest index, so later we can easily keep original order of
rows.</p>
<p>We can see that now not all indexes are connected as they should,
e.g. index 7 is not connected with index 3, but should (because 7 and 3
are connected with 4).</p>
</div>
<div id="cascade" class="section level4">
<h4>Cascade</h4>
<p>To fix this, we will - step by step, for each index - replace rest
indexes by main index. At first, let’s make a pairs: main index - one of
the rests indexes:</p>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
main_index
</th>
<th style="text-align:right;">
rest_indexes
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
</tbody>
</table>
<p>We have also sorted them by descending order, at first by
rest_indexes, then by main_index and removed duplicated pairs.</p>
<p>We can now group by rest_indexes and for each group replace the next
rest_index by previous main_index, e.g. for 12 we will have:</p>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
main_index
</th>
<th style="text-align:right;">
rest_indexes
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p>After iterate over each index (each iterate needs to end by reorder
the table - again we need to sort them by descending order, at first by
rest_indexes, then by main_index), removing duplicated: pairs and more
than one occurrence of rest_indexes, we will get:</p>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
main_index
</th>
<th style="text-align:right;">
rest_indexes
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p>The last thing to do is just to replace each rest_index by main_index
in our main table (table passed to <code>dedupe_wide</code>), starting
from the top of our pairs.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
